---
phase: 03-contact-form
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/contact.astro
  - src/components/ContactForm.astro
autonomous: true
requirements:
  - CONT-01
  - CONT-02

must_haves:
  truths:
    - "The contact page is reachable from CTA buttons on the landing, features, and about pages and from the nav"
    - "The form displays 5 fields: name (required), email (required), organization (optional), event type dropdown (optional), and message textarea (optional)"
    - "Labels are always visible above each input field and required fields show a red asterisk"
    - "Blurring out of a required field without a value shows an inline red error below the field and a red border"
    - "Entering an invalid email shows a format error, and common domain typos show a 'Did you mean...' suggestion"
    - "Submitting the form with errors shows a summary error banner at the top listing all issues"
    - "Submitting a valid form disables the button and shows a loading/spinner state for ~1.5 seconds"
    - "After the simulated submit, the form fades out and a full-page thank-you view fades in with a timeline message and homepage link"
    - "The event type dropdown offers: Gala/Fundraiser, Team Building, Conference, School/Education, Holiday Party, Other"
  artifacts:
    - path: "src/pages/contact.astro"
      provides: "Contact page shell importing ContactForm component"
      contains: "ContactForm"
    - path: "src/components/ContactForm.astro"
      provides: "Complete form with validation, loading simulation, and thank-you state"
      min_lines: 100
  key_links:
    - from: "src/pages/index.astro"
      to: "/contact"
      via: "CTA button href"
      pattern: "href=.*contact"
    - from: "src/pages/contact.astro"
      to: "src/components/ContactForm.astro"
      via: "component import"
      pattern: "import ContactForm"
    - from: "src/components/ContactForm.astro"
      to: "motion"
      via: "animate import for form/thank-you transition"
      pattern: "import.*animate.*from.*motion"
---

<objective>
Build the demo request contact form page with a ContactForm component featuring blur validation, email typo detection, simulated submission with loading state, and a full-page thank-you confirmation transition.

Purpose: This is the site's primary conversion endpoint — every CTA button across all pages funnels here. Visitors ready to request a demo complete the form and receive confirmation.
Output: `src/pages/contact.astro` (page shell) and `src/components/ContactForm.astro` (self-contained form with all logic).
</objective>

<execution_context>
@/Users/jslitzker/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jslitzker/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-contact-form/03-CONTEXT.md
@.planning/phases/03-contact-form/03-RESEARCH.md
@src/pages/contact.astro
@src/layouts/BaseLayout.astro
@src/components/ScrollAnimations.astro
@src/components/Nav.astro
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ContactForm component with fields, validation, and thank-you state</name>
  <files>src/components/ContactForm.astro</files>
  <action>
Create `src/components/ContactForm.astro` as a self-contained Astro component with all HTML and client-side logic in a `<script>` tag.

**Form HTML (inside a wrapper div):**
- Form element: `<form id="contact-form" novalidate class="...">`
- Error summary banner: `<div id="error-summary" class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg" role="alert">` with `<ul id="error-list">` inside
- 5 fields, each wrapped in a `<div class="mb-6">`:

  1. **Name** (required): `<input type="text" id="name" name="Name" required>` with label "Name" + red asterisk `<span class="text-coral">*</span>`. Placeholder: "Your full name"
  2. **Email** (required): `<input type="email" id="email" name="Email" required>` with label "Email" + red asterisk. Placeholder: "you@example.com". Include a typo suggestion element: `<p id="email-typo" class="hidden mt-1 text-sm text-electric-blue">` for "Did you mean..." suggestions
  3. **Organization** (optional): `<input type="text" id="organization" name="Organization">` with label "Organization". Placeholder: "Your company or nonprofit"
  4. **Event Type** (optional): `<select id="event-type" name="Event Type">` with label "Event Type". Options: empty default "Select event type...", "Gala/Fundraiser", "Team Building", "Conference", "School/Education", "Holiday Party", "Other". Style the select with `appearance-none` and a custom chevron SVG background
  5. **Message** (optional): `<textarea id="message" name="Message" rows="4">` with label "Message". Placeholder: "Tell us about your event..."

- Each field's error element: `<p id="{field-id}-error" class="hidden mt-1 text-sm text-red-500" role="alert"></p>`

- Submit button: `<button type="submit" id="submit-btn" class="w-full px-8 py-4 text-lg font-bold rounded-brand bg-gold text-navy hover:bg-gold/90 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">` containing:
  - `<span class="btn-text">Request a Demo</span>`
  - `<span class="btn-spinner hidden">` with a simple CSS spinner (inline SVG or Tailwind animate-spin on a circle SVG)

**Input styling (all inputs/select/textarea):**
`w-full px-4 py-3 rounded-lg border border-navy/20 bg-white text-navy placeholder:text-navy/40 focus:outline-none focus:ring-2 focus:ring-electric-blue focus:border-transparent transition-colors`

**Label styling:**
`block text-sm font-semibold text-navy mb-2`

**Thank-you view (hidden by default):**
`<div id="thank-you" class="hidden text-center py-16">` containing:
- Success icon: a large checkmark circle (inline SVG, `w-20 h-20 text-green-500 mx-auto mb-8`) or use gold brand color
- Heading: `text-4xl font-bold text-navy mb-4` — "Thank You!"
- Message: `text-lg text-navy/70 mb-2` — "Your demo request has been received."
- Timeline: `text-navy/60 mb-10` — "We'll reach out within 24 hours."
- Homepage link: `<a href="/" class="inline-block px-8 py-4 text-lg font-bold rounded-brand bg-deep-blue text-white hover:bg-deep-blue/90 transition-colors">Back to Home</a>`

**Client-side script (`<script>` tag):**

1. **Email typo map** — Object mapping common domain typos to corrections: gmial.com->gmail.com, gmai.com->gmail.com, gamil.com->gmail.com, gnail.com->gmail.com, yahooo.com->yahoo.com, yaho.com->yahoo.com, hotmal.com->hotmail.com, outlok.com->outlook.com

2. **`checkEmailTypo(email: string): string | null`** — Extract domain after @, look up in typo map, return corrected full email or null

3. **`isValidEmail(email: string): boolean`** — Simple check: contains @, has text before @, domain has at least one dot. Do NOT use a complex regex. Pattern: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`

4. **`validateField(field: HTMLElement): string`** — Returns error message or empty string:
   - If field has `required` attribute and value is empty/whitespace: return "{Label} is required"
   - If field is email type and has value: check `isValidEmail()`, if invalid return "Please enter a valid email address"
   - If email is valid format: check `checkEmailTypo()`, if typo found show suggestion in `#email-typo` element (NOT as an error — just a helpful hint in blue text: "Did you mean {suggestion}?")
   - If valid: clear error, remove red border, add normal border back
   - If invalid: show error in field's error element, add `border-red-500` class, remove `border-navy/20`
   - Set `aria-invalid` attribute on the field accordingly

5. **Blur event listeners** — For each input/select/textarea in the form, add blur listener that calls `validateField()`

6. **`validateAll(): boolean`** — Validate all fields, collect errors, populate error summary banner if any errors exist. Return true if no errors. If errors: show `#error-summary`, populate `#error-list` with `<li>` for each error, scroll to top of form, focus first invalid field

7. **Submit handler** — `form.addEventListener('submit', async (e) => { ... })`:
   - `e.preventDefault()`
   - Call `validateAll()` — if false, return
   - Disable submit button, hide btn-text, show btn-spinner
   - `await new Promise(resolve => setTimeout(resolve, 1500))` (simulated delay)
   - Import `animate` from `motion`
   - Animate form: `animate(form, { opacity: [1, 0] }, { duration: 0.3 })`
   - After animation finishes: hide form (`hidden` class), show thank-you div, `window.scrollTo({ top: 0, behavior: 'smooth' })`, animate thank-you: `animate(thankYou, { opacity: [0, 1], y: [20, 0] }, { duration: 0.5 })`

Use dynamic `import('motion')` inside the submit handler to avoid loading Motion until needed (keeps initial page JS minimal).
  </action>
  <verify>Run `npm run build` — no TypeScript or Astro errors. Visually confirm the component renders fields with correct labels and placeholder text.</verify>
  <done>ContactForm.astro exists with all 5 form fields, error elements, submit button with spinner, hidden thank-you view, and complete client-side validation/submission script.</done>
</task>

<task type="auto">
  <name>Task 2: Build contact page shell and integrate ContactForm</name>
  <files>src/pages/contact.astro</files>
  <action>
Replace the placeholder content in `src/pages/contact.astro` with the full contact page:

**Page structure:**
```astro
---
import BaseLayout from '../layouts/BaseLayout.astro';
import ContactForm from '../components/ContactForm.astro';
---

<BaseLayout title="Request a Demo" description="Request a demo of Rally Trivia for your next fundraiser, team building event, or corporate gathering">
  <!-- Hero section -->
  <!-- Form section -->
</BaseLayout>
```

**Hero section** (matches secondary page pattern from features/about — py-32 md:py-40, NOT min-h-screen):
- `<section class="py-32 md:py-40 px-4 bg-navy text-center animate-on-scroll">`
- Heading: `text-5xl md:text-6xl font-bold text-white mb-4` — "Request a Demo" (direct, action-oriented per user decision)
- Subtitle: `text-xl text-white/70 max-w-2xl mx-auto` — brief one-liner intro (e.g., "Tell us about your event and we'll show you how Rally Trivia can make it unforgettable.")
- Minimal content per user decision — no trust signals, no extra marketing copy

**Form section:**
- `<section class="py-24 px-4 bg-white animate-on-scroll">`
- Inner container: `max-w-xl mx-auto` (centered single-column layout — clean and focused, fits the minimal approach)
- `<ContactForm />`

Ensure the page uses the same BaseLayout pattern as all other pages. The SEO description should mention demo requests for events.
  </action>
  <verify>Run `npm run build` — no errors. Open `http://localhost:4321/contact` in dev server and confirm: hero section with heading + subtitle, form section with all 5 fields rendered, labels visible above inputs, submit button visible. Test blur validation by tabbing through name and email without entering values — error messages should appear. Enter an email with "gmial.com" domain — blue typo suggestion should appear. Fill in name and email, submit — button should show spinner for ~1.5s then transition to thank-you view with checkmark, message, and homepage link.</verify>
  <done>Contact page displays a dark hero with "Request a Demo" heading, a centered form with 5 fields, blur validation with inline errors and summary banner, email typo suggestions, simulated submission loading state, and a full-page thank-you transition — all responsive and using brand colors.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes with no errors
2. Contact page at `http://localhost:4321/contact` shows hero section + form
3. CTA buttons on landing (`/`), features (`/features`), about (`/about`), and nav all link to `/contact` (already verified — pre-existing)
4. Name and email fields show red border + inline error on blur when empty
5. Email field shows "Did you mean..." blue text for common typos like gmial.com
6. Submitting with errors shows summary banner at top of form listing all issues
7. Submitting valid form shows spinner on button for ~1.5 seconds
8. After simulated submit, form fades out and thank-you view fades in
9. Thank-you view shows success icon, "We'll reach out within 24 hours", and "Back to Home" link
10. Event type dropdown contains all 6 specified options
11. Page is responsive at 375px, 768px, 1280px
12. Sections have `animate-on-scroll` class for scroll-triggered animations
</verification>

<success_criteria>
The contact page is the site's functional conversion endpoint — visitors can fill out the demo request form with validation feedback, submit it with a polished loading state, and see a clear thank-you confirmation with expected timeline and a way back to the homepage.
</success_criteria>

<output>
After completion, create `.planning/phases/03-contact-form/03-01-SUMMARY.md`
</output>
