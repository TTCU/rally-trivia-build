---
// ContactForm: Demo request form with blur validation, email typo detection,
// simulated submit loading state, and animated thank-you transition.
// Self-contained â€” all HTML and client-side logic in this component.
---

<div>
  <!-- Error Summary Banner -->
  <div id="error-summary" class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg" role="alert">
    <p class="text-sm font-semibold text-red-800 mb-2">Please fix the following errors:</p>
    <ul id="error-list" class="list-disc list-inside text-sm text-red-700 space-y-1"></ul>
  </div>

  <!-- Contact Form -->
  <form id="contact-form" novalidate class="space-y-0">

    <!-- Name (required) -->
    <div class="mb-6">
      <label for="name" class="block text-sm font-semibold text-heading mb-2">
        Name <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="name"
        name="Name"
        required
        placeholder="Your full name"
        class="w-full px-4 py-3 rounded-lg border border-border bg-white text-heading placeholder:text-body-light focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
        aria-describedby="name-error"
      />
      <p id="name-error" class="hidden mt-1 text-sm text-red-500" role="alert"></p>
    </div>

    <!-- Email (required) -->
    <div class="mb-6">
      <label for="email" class="block text-sm font-semibold text-heading mb-2">
        Email <span class="text-red-500">*</span>
      </label>
      <input
        type="email"
        id="email"
        name="Email"
        required
        placeholder="you@example.com"
        class="w-full px-4 py-3 rounded-lg border border-border bg-white text-heading placeholder:text-body-light focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
        aria-describedby="email-error email-typo"
      />
      <p id="email-error" class="hidden mt-1 text-sm text-red-500" role="alert"></p>
      <p id="email-typo" class="hidden mt-1 text-sm text-primary"></p>
    </div>

    <!-- Organization (optional) -->
    <div class="mb-6">
      <label for="organization" class="block text-sm font-semibold text-heading mb-2">
        Organization
      </label>
      <input
        type="text"
        id="organization"
        name="Organization"
        placeholder="Your company or nonprofit"
        class="w-full px-4 py-3 rounded-lg border border-border bg-white text-heading placeholder:text-body-light focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
      />
    </div>

    <!-- Event Type (optional) -->
    <div class="mb-6">
      <label for="event-type" class="block text-sm font-semibold text-heading mb-2">
        Event Type
      </label>
      <div class="relative">
        <select
          id="event-type"
          name="Event Type"
          class="w-full px-4 py-3 rounded-lg border border-border bg-white text-heading focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors appearance-none pr-10"
        >
          <option value="">Select event type...</option>
          <option value="gala">Gala/Fundraiser</option>
          <option value="team-building">Team Building</option>
          <option value="conference">Conference</option>
          <option value="education">School/Education</option>
          <option value="holiday">Holiday Party</option>
          <option value="other">Other</option>
        </select>
        <!-- Custom chevron -->
        <svg class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-body-light" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
    </div>

    <!-- Message (optional) -->
    <div class="mb-8">
      <label for="message" class="block text-sm font-semibold text-heading mb-2">
        Message
      </label>
      <textarea
        id="message"
        name="Message"
        rows="4"
        placeholder="Tell us about your event..."
        class="w-full px-4 py-3 rounded-lg border border-border bg-white text-heading placeholder:text-body-light focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors resize-y"
      ></textarea>
    </div>

    <!-- Submit Button -->
    <button
      type="submit"
      id="submit-btn"
      class="w-full px-8 py-4 text-lg font-bold rounded-brand bg-primary text-white hover:bg-primary/90 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      <span class="btn-text">Request a Demo</span>
      <span class="btn-spinner hidden inline-flex items-center justify-center">
        <svg class="animate-spin h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </span>
    </button>

  </form>

  <!-- Thank-You View (hidden by default) -->
  <div id="thank-you" class="hidden text-center py-16">
    <!-- Success checkmark icon -->
    <div class="w-20 h-20 mx-auto mb-8 rounded-full bg-primary/10 flex items-center justify-center">
      <svg class="w-10 h-10 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
      </svg>
    </div>
    <h2 class="text-4xl font-bold text-heading mb-4">Thank You!</h2>
    <p class="text-lg text-body mb-2">Your demo request has been received.</p>
    <p class="text-body-light mb-10">We'll reach out within 24 hours.</p>
    <a
      href="/"
      class="inline-block px-8 py-4 text-lg font-bold rounded-brand bg-heading text-white hover:bg-heading/90 transition-colors duration-200"
    >
      Back to Home
    </a>
  </div>
</div>

<script>
  // Email typo detection map
  const TYPO_MAP: Record<string, string> = {
    'gmial.com': 'gmail.com',
    'gmai.com': 'gmail.com',
    'gamil.com': 'gmail.com',
    'gnail.com': 'gmail.com',
    'yahooo.com': 'yahoo.com',
    'yaho.com': 'yahoo.com',
    'hotmal.com': 'hotmail.com',
    'outlok.com': 'outlook.com',
  };

  function checkEmailTypo(email: string): string | null {
    const domain = email.split('@')[1]?.toLowerCase();
    if (domain && TYPO_MAP[domain]) {
      return email.replace(/@.*$/, '@' + TYPO_MAP[domain]);
    }
    return null;
  }

  function isValidEmail(email: string): boolean {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function getFieldLabel(field: HTMLElement): string {
    const label = document.querySelector(`label[for="${field.id}"]`);
    if (label) {
      // Get text content without the asterisk span
      return label.textContent?.replace('*', '').trim() || field.id;
    }
    return field.id;
  }

  function validateField(field: HTMLElement): string {
    const errorEl = document.getElementById(`${field.id}-error`);
    const typoEl = document.getElementById('email-typo');
    let message = '';

    if (field instanceof HTMLInputElement || field instanceof HTMLTextAreaElement) {
      const value = field.value.trim();

      // Required check
      if (field.hasAttribute('required') && !value) {
        message = `${getFieldLabel(field)} is required`;
      }
      // Email format check
      else if (field.type === 'email' && value) {
        if (!isValidEmail(value)) {
          message = 'Please enter a valid email address';
        } else {
          // Check for typos (show as hint, not error)
          const suggestion = checkEmailTypo(value);
          if (typoEl) {
            if (suggestion) {
              typoEl.textContent = `Did you mean ${suggestion}?`;
              typoEl.classList.remove('hidden');
            } else {
              typoEl.textContent = '';
              typoEl.classList.add('hidden');
            }
          }
        }
      }
    }

    // Update error display
    if (errorEl) {
      errorEl.textContent = message;
      errorEl.classList.toggle('hidden', !message);
    }

    // Update field border styling
    if (message) {
      field.classList.remove('border-border');
      field.classList.add('border-red-500');
      field.setAttribute('aria-invalid', 'true');
    } else {
      field.classList.remove('border-red-500');
      field.classList.add('border-border');
      field.removeAttribute('aria-invalid');
    }

    return message;
  }

  function validateAll(): boolean {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const errorSummary = document.getElementById('error-summary')!;
    const errorList = document.getElementById('error-list')!;
    const errors: string[] = [];
    let firstInvalid: HTMLElement | null = null;

    // Validate all required fields
    const fields = form.querySelectorAll<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>(
      'input, select, textarea'
    );

    fields.forEach((field) => {
      const message = validateField(field as HTMLElement);
      if (message) {
        errors.push(message);
        if (!firstInvalid) firstInvalid = field as HTMLElement;
      }
    });

    // Update error summary
    if (errors.length > 0) {
      errorList.innerHTML = errors.map((e) => `<li>${e}</li>`).join('');
      errorSummary.classList.remove('hidden');
      errorSummary.scrollIntoView({ behavior: 'smooth', block: 'center' });
      if (firstInvalid) firstInvalid.focus();
      return false;
    } else {
      errorSummary.classList.add('hidden');
      errorList.innerHTML = '';
      return true;
    }
  }

  // Initialize form
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const thankYou = document.getElementById('thank-you')!;

  if (form) {
    // Blur validation on all fields
    form.querySelectorAll<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>(
      'input, select, textarea'
    ).forEach((field) => {
      field.addEventListener('blur', () => validateField(field as HTMLElement));
    });

    // Submit handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!validateAll()) return;

      const btn = document.getElementById('submit-btn') as HTMLButtonElement;
      const btnText = btn.querySelector('.btn-text')!;
      const btnSpinner = btn.querySelector('.btn-spinner')!;

      // Show loading state
      btn.disabled = true;
      btnText.classList.add('hidden');
      btnSpinner.classList.remove('hidden');

      // Simulated submit delay
      await new Promise((resolve) => setTimeout(resolve, 1500));

      // Animate transition
      const { animate } = await import('motion');

      // Fade out form wrapper (includes error summary + form)
      const formWrapper = form.parentElement!;
      await animate(formWrapper, { opacity: [1, 0] }, { duration: 0.3 }).finished;

      // Hide form elements, show thank-you
      form.classList.add('hidden');
      document.getElementById('error-summary')!.classList.add('hidden');
      thankYou.classList.remove('hidden');

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Fade in thank-you
      animate(thankYou, { opacity: [0, 1], y: [20, 0] }, { duration: 0.5 });
    });
  }
</script>
